<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Beu Instrument — Plushie Piano (Extended)</title>
  <style>
    :root{--bg:#0f1220;--card:#151935;--ink:#f2f5ff;--accent:#a7c4ff;--accent2:#ffd2f9}
    *{box-sizing:border-box} body{margin:0;font-family:ui-rounded,system-ui,Segoe UI,Roboto,Apple Color Emoji,Twitter Color Emoji,Noto Color Emoji;background:linear-gradient(180deg,#0f1220,#0c0f1a);color:var(--ink);min-height:100svh;display:grid;place-items:center}
    .wrap{width:min(1000px,94vw);padding:28px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.08);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:22px}
    h1{margin:0 0 8px;font-size:clamp(20px,2.6vw,30px)}
    p{opacity:.86;margin:0 0 18px}
    .grid{display:grid;grid-template-columns:repeat(8,minmax(0,1fr));gap:12px}
    .key{position:relative;user-select:none;cursor:pointer;background:#1a1f45;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px 12px;text-align:center;transition:.15s transform,.15s box-shadow}
    .key kbd{display:inline-block;font-weight:700;background:rgba(255,255,255,.06);padding:.3em .55em;border-radius:8px;margin-bottom:6px}
    .key small{display:block;opacity:.8}
    .key:hover{transform:translateY(-2px)}
    .key:active,.key.playing{transform:translateY(1px);box-shadow:0 0 0 3px rgba(167,196,255,.25) inset}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px}
    button{appearance:none;cursor:pointer;background:linear-gradient(180deg,#6ea8ff,#5a90ea);color:#0b0e1a;border:0;border-radius:12px;padding:12px 14px;font-weight:800}
    button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(167,196,255,.45)}
    .hint{font-size:13px;opacity:.75;margin-top:6px}
    .footer{opacity:.6;margin-top:18px;font-size:13px}
    .err{color:#ffd2d2}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Beu Instrument — Plushie Piano (Extended)</h1>
      <p>Make sure all WAV files are next to this HTML (the original 4 + the new 13 barccs). Click <b>Enable Audio</b> then smash the keys :3</p>

      <div class="row">
        <button id="enable">Enable Audio</button>
        <button id="demo" class="ghost">Play Tiny Demo</button>
      </div>
      <div id="status" class="hint"></div>

      <h3 style="margin:18px 0 10px">Key Map</h3>
      <div class="grid" id="keys"></div>

      <div class="footer">Row 1 = Squeaks/Plops · Row 2 = Special Barccs · Space = Random Barcc · Enter = Eepy Beu · Shift = Plop · ↑/↓ = Pitch bend</div>
      <div id="error" class="hint err"></div>
    </div>
  </div>

<script>
(() => {
  const keyLayout = [
    {label:'A', note:'+0', file:'beu_squeak.wav', rate:1.00},
    {label:'S', note:'+2', file:'beu_squeak.wav', rate:1.1225},
    {label:'D', note:'+4', file:'beu_squeak.wav', rate:1.2599},
    {label:'F', note:'+5', file:'beu_squeak.wav', rate:1.3348},
    {label:'G', note:'+7', file:'beu_squeak.wav', rate:1.4983},
    {label:'H', note:'+9', file:'beu_squeak.wav', rate:1.6818},
    {label:'J', note:'+11',file:'beu_squeak.wav', rate:1.8877},
    {label:'K', note:'+12',file:'beu_squeak.wav', rate:2.0000},
    {label:'L', note:'BARCC', file:'beu_barcc.wav', rate:1.0},
    {label:';', note:'PLOP',  file:'beu_plop.wav', rate:1.0},
    {label:"'", note:'SQUEAL',file:'beu_squeak.wav', rate:2.25},
    {label:'/', note:'LOW squeak', file:'beu_squeak.wav', rate:0.75},
    // New: Barcc Pack row (Q-–)
    {label:'Q', note:'Double', file:'beu_double_barcc.wav', rate:1.0},
    {label:'W', note:'Zoomie', file:'beu_zoomie_barcc.wav', rate:1.0},
    {label:'E', note:'Echo', file:'beu_echo_barcc.wav', rate:1.0},
    {label:'R', note:'Muffled', file:'beu_muffled_barcc.wav', rate:1.0},
    {label:'T', note:'Stutter', file:'beu_stutter_barcc.wav', rate:1.0},
    {label:'Y', note:'Hungry', file:'beu_hungry_barcc.wav', rate:1.0},
    {label:'U', note:'Sleepy', file:'beu_sleepy_barcc.wav', rate:1.0},
    {label:'I', note:'Angy', file:'beu_angy_barcc.wav', rate:1.0},
    {label:'O', note:'Happy', file:'beu_happy_barcc.wav', rate:1.0},
    {label:'P', note:'Reverse', file:'beu_reverse_barcc.wav', rate:1.0},
    {label:'[', note:'Harmonized', file:'beu_harmonized_barcc.wav', rate:1.0},
    {label:']', note:'Mega', file:'beu_mega_barcc.wav', rate:1.0},
    {label:'-', note:'Glitchy', file:'beu_glitchy_barcc.wav', rate:1.0}
  ];

  let ctx, gain;
  const buffers = new Map();
  const activeUI = new Map();
  const statusEl = document.getElementById('status');
  const errEl = document.getElementById('error');

  const keysWrap = document.getElementById('keys');
  keyLayout.forEach((k,i)=>{
    const el = document.createElement('div');
    el.className = 'key';
    el.innerHTML = `<kbd>${k.label}</kbd><small>${k.note}</small>`;
    el.onclick = () => playIndex(i);
    keysWrap.appendChild(el);
    activeUI.set(i, el);
  });

  const keyToIdx = {
    'a':0,'s':1,'d':2,'f':3,'g':4,'h':5,'j':6,'k':7,
    'l':8,';':9,"'":10,'/':11,
    // Barcc Pack row
    'q':12,'w':13,'e':14,'r':15,'t':16,'y':17,'u':18,'i':19,'o':20,'p':21,'[':22,']':23,'-':24
  };
  keyLayout.forEach((k,i)=>{ keyToIdx[k.label.toLowerCase()] = i; });

  async function setup() {
    try {
      ctx = new (window.AudioContext || window.webkitAudioContext)();
      gain = ctx.createGain();
      gain.gain.value = 0.9;
      gain.connect(ctx.destination);
      const files = [...new Set(keyLayout.map(k=>k.file).concat(['beu_eepy.wav']))];
      statusEl.textContent = 'Loading samples…';
      await Promise.all(files.map(loadFile));
      statusEl.textContent = 'Ready! Press keys!';
      errEl.textContent = '';
    } catch (e) {
      console.error(e);
      errEl.textContent = 'Audio init failed. Browser blocked sound or files missing?';
    }
  }

  async function loadFile(name){
    if (buffers.has(name)) return;
    const res = await fetch(name);
    if (!res.ok) throw new Error('Missing file: '+name);
    const arr = await res.arrayBuffer();
    const buf = await new Promise((ok,err)=>ctx.decodeAudioData(arr,ok,err));
    buffers.set(name, buf);
  }

  function playBuffer(name, {rate=1, when=0}={}){
    const buf = buffers.get(name);
    if (!buf) return;
    const src = ctx.createBufferSource();
    src.buffer = buf;
    src.playbackRate.value = rate;

    const v = ctx.createGain();
    v.gain.value = 0.0;
    v.connect(gain);
    const now = ctx.currentTime + when;
    v.gain.setValueAtTime(0, now);
    v.gain.linearRampToValueAtTime(1, now + 0.01);
    v.gain.exponentialRampToValueAtTime(0.001, now + Math.min(0.6, buf.duration/rate));

    src.connect(v);
    src.start(now);
    return {src, v};
  }

  function blip(index){
    const el = activeUI.get(index);
    if (!el) return;
    el.classList.add('playing');
    setTimeout(()=>el.classList.remove('playing'), 140);
  }

  function playIndex(i){
    const spec = keyLayout[i];
    if (!spec) return;
    blip(i);
    playBuffer(spec.file, {rate: spec.rate});
  }

  function randomBarcc(){
    const barccs = keyLayout.filter(k=>k.note.includes('Barcc'));
    const pick = barccs[Math.floor(Math.random()*barccs.length)];
    playBuffer(pick.file,{rate:pick.rate});
  }
  function eepy(){ playBuffer('beu_eepy.wav',{rate:1}); }
  function plop(){ playBuffer('beu_plop.wav',{rate:1}); }

  async function demo(){
    if (!ctx) return;
    const seq = [0,1,2,3,4,5,6,7];
    seq.forEach((i,step)=>{
      playBuffer(keyLayout[i].file,{rate:keyLayout[i].rate, when:(step*0.22)});
      if (Math.random()<0.5){
        setTimeout(randomBarcc, step*220 + 120);
      }
    });
    setTimeout(eepy, 1800);
  }

  let bend = 0;
  window.addEventListener('keydown', (e)=>{
    if (!ctx) return;
    if (e.key === ' '){ e.preventDefault(); randomBarcc(); return; }
    if (e.key === 'Enter'){ e.preventDefault(); eepy(); return; }
    if (e.key === 'Shift'){ e.preventDefault(); plop(); return; }
    if (e.key === 'ArrowUp'){ bend = Math.min(12,bend+1); statusEl.textContent=`Pitch bend: +${bend} st`; return; }
    if (e.key === 'ArrowDown'){ bend = Math.max(-12,bend-1); statusEl.textContent=`Pitch bend: ${bend} st`; return; }
    const i = keyToIdx[e.key.toLowerCase()];
    if (i!=null){
      const spec = keyLayout[i];
      const rate = spec.rate * Math.pow(2,bend/12);
      blip(i);
      playBuffer(spec.file,{rate});
    }
  });

  document.getElementById('enable').addEventListener('click', async ()=>{
    await setup();
    if (ctx && ctx.state==='suspended') await ctx.resume();
  });
  document.getElementById('demo').addEventListener('click', demo);
})();
</script>
</body>
</html>
